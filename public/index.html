<!DOCTYPE html>
<html>
  <head>
    <title>Create a one time link for you message</title>
    <link type="text/css" rel="stylesheet" href="/styles/main.css" />
    <link
      type="text/css"
      rel="stylesheet"
      href="../node_modules/bootstrap/dist/css/bootstrap.min.css"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
  </head>
  <body>
    <header class="page-header">
      <h2>Create link</h2>
      <div>
        <p>
          Create a temporary link for your product, business and organisation.
        </p>
        <p>Links created will expire after a week if date is not specified.</p>
      </div>
    </header>

    <main class="page-main">
      <form
        action="/message"
        method="POST"
        name="createMsg"
        enctype="application/json"
        class="page-form-create-msg"
      >
        <textarea name="data" placeholder="Type your message"></textarea>

        <details class="page-form-adv-create-msg">
          <summary>Advanced options</summary>
          <div>
            <div>
              <input
                type="datetime-local"
                name="ttl"
                placeholder="Expiry date"
              />
            </div>

            <div>
              <input
                type="number"
                min="0"
                name="count"
                placeholder="View limit"
              />
            </div>

            <div>
              <input
                type="password"
                name="passcode"
                placeholder="Type your password"
              />
            </div>
          </div>
        </details>
        <!-- <input type="" name="data">
    <input type="" name="data"> -->
        <button type="submit">Send</button>
      </form>

      <div>Share your link <a id="shareLink" href=""></a></div>
    </main>

    <script type="text/javascript" src="/js/makeRequest.js"></script>

    <script>
      let form = document.createMsg;
      const linkView = document.querySelector("#shareLink");

      form.addEventListener("submit", (e) => {
        e.preventDefault();
        e.stopPropagation();
        console.log(e);
        let options = {};
        options.headers = { "Content-Type": "application/json" };
        options.body = parseForm(form);

        makeRequest("/message", "POST", options).then((res) => {
          console.log(res);
          const url = res.data.url;
          linkView.href = linkView.innerText = url + "/view";
        });
      });

      function parseForm(formElement) {
        const obj = {};
        Array.from(formElement.elements).forEach((e) => {
          obj[e.name] = e.value;
        });

        return obj;
      }
    </script>
  </body>
</html>
